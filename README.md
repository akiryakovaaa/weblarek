# Проектная работа "Веб-ларек" 

Стек: HTML, SCSS, TS, Vite 

Структура проекта: 
- src/ — исходные файлы проекта 
- src/components/ — папка с JS компонентами 
- src/components/base/ — папка с базовым кодом 

Важные файлы: 
- index.html — HTML-файл главной страницы 
- src/types/index.ts — файл с типами 
- src/main.ts — точка входа приложения 
- src/scss/styles.scss — корневой файл стилей 
- src/utils/constants.ts — файл с константами 
- src/utils/utils.ts — файл с утилитами 


## Установка и запуск 
Для установки и запуска проекта необходимо выполнить команды 

``` 

npm install 
npm run dev 

``` 


или 


``` 

yarn 
yarn dev 

``` 

## Сборка 
``` 
npm run build 

``` 

или 

 
``` 
yarn build 

``` 

# Интернет-магазин «Web-Larёk» 
«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер. 

 
## Архитектура приложения 
Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность: 

Model - слой данных, отвечает за хранение и изменение данных.   
View - слой представления, отвечает за отображение данных на странице.   
Presenter - презентер содержит основную логику приложения и  отвечает за связь представления и данных. 

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений. 

### Базовый код 

#### Класс Component 
Является базовым классом для всех компонентов интерфейса. 
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения. 

Конструктор:   
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает. 

Поля класса:   
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента. 

Методы класса:   
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.   
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>` 

#### Класс Api 
Содержит в себе базовую логику отправки запросов. 

Конструктор:   
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов. 

Поля класса:   
`baseUrl: string` - базовый адрес сервера   
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов. 

Методы:   
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер   
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.   
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных. 

#### Класс EventEmitter 
Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления. 

Конструктор класса не принимает параметров. 

Поля класса:   
`_events: Map<string | RegExp, Set<Function>>)` -  хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события. 

Методы класса:   
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.   
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.   
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра. 

## Данные 
В приложении используются две сущности: товар и покупатель. Они определяют структуру данных, с которыми работают модели приложения. 

### Интерфейс товара 
interface IProduct { 
  id: string; 
  description: string; 
  image: string; 
  title: string; 
  category: string; 
  price: number | null; 
} 

Назначение: 
Описывает объект товара, который отображается в каталоге, используется в корзине и передаётся в запросах на оформление заказа. 

Поля: 
`id` — уникальный идентификатор товара 
`title` — название 
`image` — изображение товара 
`category` — категория товара 
`price` — стоимость товара 
`description` — подробное описание 

### Интерфейс покупателя 
interface IBuyer { 
  payment: TPayment; 
  email: string; 
  phone: string; 
  address: string; 
} 

Назначение: 
Структура данных, которые пользователь вводит при оформлении заказа. 

Поля: 
`payment` — выбранный метод оплаты ('card' | 'cash') 
`email` — электронная почта 
`phone` — телефон 
`address` — адрес доставки 

## Модели данных 
В приложении используются три модели данных, каждая отвечает за свою область ответственности: каталог товаров, корзина и данные покупателя. 

### Каталог товаров 
Назначение: 
Модель хранит список всех доступных товаров, а также товар, выбранный пользователем для подробного просмотра. 

Конструктор: 
`constructor()` - параметров не принимает, инициализирует пустые структуры данных. 

Поля класса: 
`private items: IProduct[]` - Массив всех товаров, полученных с сервера. 
`private selected: IProduct | null`  - Товар, выбранный для детального отображения (например, в модальном окне). 

Методы класса: 
`setItems(items: IProduct[]): void` - Сохраняет массив товаров. 
`getItems(): IProduct[]` - Возвращает массив товаров. 
`getItemById(id: string): IProduct | undefined` - Ищет товар по ID. 
`setSelected(item: IProduct): void` - Сохраняет товар, выбранный для просмотра. 
`getSelected(): IProduct | null` - Возвращает выбранный товар. 

### Корзина 
Назначение: 
Определяет товары, которые пользователь добавил в корзину, и операции по управлению ими. 

Конструктор: 
constructor() 

Поля класса: 
private items: IProduct[] - Массив товаров, выбранных пользователем. 

Методы класса: 
`getItems(): IProduct[]` - Получить содержимое корзины. 
`addItem(item: IProduct): void` - Добавить товар. 
`removeItem(item: IProduct): void` - Удалить товар. 
`clear(): void` - Очистить корзину. 
`getTotal(): number` - Общая стоимость всех товаров в корзине. 
`getCount(): number` - Количество товаров. 
`hasItem(id: string): boolean` - Проверка наличия товара по ID. 


### Покупатель 
Назначение: 
Модель хранит данные формы заказа и обеспечивает их валидацию. 

Конструктор: 
constructor() 

Поля класса: 
`private payment: TPayment | null` 
`private address: string` 
`private email: string` 
`private phone: string` 

Все поля могут быть установлены постепенно, по одному. 

Методы класса: 
`setData(data: Partial<IBuyer>): void` - Сохраняет переданные данные, не удаляя уже существующие. 
`getData(): IBuyer` - Возвращает все данные пользователя. 
`clear(): void` - Полностью очищает форму заказа. 
`validate(): Record<string, string>` - Проверяет корректность каждого поля. 

Возвращает объект ошибок вида: 
{ 
  payment?: 'Не выбран способ оплаты', 
  email?: 'Укажите email', 
  phone?: 'Укажите телефон', 
  address?: 'Укажите адрес' 
} 

## Слой коммуникации 
Слой коммуникации отвечает за взаимодействие приложения «Web-Larёk» с API сервера. 

Для этого используется отдельный класс, который инкапсулирует работу базового класса Api и предоставляет методы высокого уровня для получения каталога товаров и отправки заказа. 

### Класс LarekApi: 
Класс LarekApi использует композицию: в конструктор ему передаётся экземпляр класса, реализующего интерфейс IApi. Далее LarekApi вызывает у него методы get и post для выполнения HTTP-запросов. 

Назначение и зона ответственности: 
получение массива товаров с сервера через запрос `GET /product/`; 
отправка заказа через запрос `POST /order/`; 
преобразование данных в типы, используемые в приложении `(IProduct, IOrder, IOrderResult)`. 

Конструктор: 
`constructor(api: IApi)` 

Параметры: 
`api: IApi` — объект, реализующий интерфейс IApi. Используется для выполнения HTTP-запросов.  

Методы класса: 
`getProducts(): Promise<IProduct[]>` - Выполняет GET /product/ через переданный объект api. Получает от сервера объект с массивом товаров и возвращает массив товаров типа IProduct. 
`createOrder(order: IOrder): Promise<IOrderResult>` - Выполняет запрос POST /order/ и отправляет на сервер данные заказа. В параметр order передаётся объект с данными покупателя и списком id выбранных товаров. 

## 3. Слой представления (View)

### 3.1. Общие принципы
Слой Представления (View) отвечает только за отображение данных и работу с DOM.  
Основные принципы:

1. Каждый класс View отвечает только за свой фрагмент интерфейса.
2. В классе представления не хранятся данные — они принадлежат только Моделям данных.
3. Все элементы разметки находятся и сохраняются в полях класса в конструкторе.
4. Все слушатели событий устанавливаются один раз — также в конструкторе.
5. Любое действие пользователя вызывает генерацию события через брокер событий.
6. View не содержит логики приложения и не решает, что должно происходить с данными.
7. View никогда не вызывает методы моделей напрямую.
8. Метод `render()` возвращает готовый DOM-элемент без передачи данных.
9. Изменение разметки компонента происходит только:
   - при обработке события от моделей (данные изменились),
   - при открытии модального окна.
10. Вся разметка в модальных окнах — самостоятельные компоненты и не наследуются от класса модального окна.


### 3.2. Базовые классы View

#### BaseComponent
Базовый класс компонента интерфейса.  
Отвечает за работу с любым DOM-элементом, который является представлением компонента.

Отвечает за:
- хранение корневого DOM-элемента;
- поиск внутренних элементов в конструкторе;
- базовый метод `render()` — возвращает DOM-элемент компонента;
- методы для обновления данных в разметке (`setText`, `setImage`, `setDisabled`, добавление/удаление классов и т.п.).


#### BaseCard
Родительский класс для всех карточек товара (каталог, модалка «товар», корзина).

Общее поведение, вынесенное в родителя:
- привязка к корневому темплейту карточки;
- установка данных товара: название, категория, изображение, цена;
- логика блокировки кнопки «Купить», если нет цены;
- методы обновления состояния кнопок;
- генерация событий клика по карточке / по кнопкам (реализуют наследники).

Методы:
- `setData(product: IProduct)` — заполняет карточку данными;
- `setCategory(category: string)` — устанавливает фон категории;
- `setButtonState(…)` — включить/выключить кнопку, изменить текст;
- `render()`.

Наследники переопределяют:
- какую кнопку показывать («Купить», «Удалить», или нет кнопки вообще);
- какие события генерируются.

---

#### 3.2.3. BaseForm
Родительский класс для двух форм оформления заказа (оплата+доставка и контакты).

Общее поведение, вынесенное в родителя:
- поиск всех инпутов и кнопки отправки;
- установка слушателей изменения полей;
- отображение ошибок валидации;
- метод `setErrors()` для показа/скрытия ошибок;
- метод `render()`.

Методы:
- `setField(name, value)` — установить значение поля;
- `setError(field, message)` — показать ошибку;
- `clearErrors()` — сброс ошибок;
- `onInput()` — генерация события при изменении данных формы.

Наследники реализуют:
- собственный набор полей;
- отдельные правила состояния кнопки («Далее» / «Оплатить»);
- собственные события.

### 3.3. Карточки товаров (3 вида + общий родитель)
Все карточки наследуются от `BaseCard` и используют разные HTML-шаблоны.  
Каждая карточка отображает информацию о товаре и генерирует события при взаимодействии пользователя.

#### CardCatalog
Карточка товара, отображаемая на главной странице в каталоге.

Темплейт: карточка из секции каталога (макет: product card).

Отвечает за:
- отображение изображения, названия, категории и цены;
- отображение кнопки «Купить» (или «Недоступно», если нет цены);
- реакцию на клик по самой карточке (открытие модалки товара).

Генерирует события:
- `card:select` — пользователь нажал на карточку для просмотра товара;
- `card:add-to-basket` — пользователь нажал «Купить».

#### 3.3.2. CardPreview
Карточка, используемая в модальном окне просмотра товара.

Особенности:
- расширенная разметка: описание товара, кнопка купить/удалить;
- используется внутри компонента модального окна.

Отвечает за:
- отображение всех данных выбранного товара;
- динамическое состояние кнопки: «Купить», «Удалить из корзины», «Недоступно».

Генерирует события:
- `preview:add-to-basket`;
- `preview:remove-from-basket`.

#### 3.3.3. CardBasket
Карточка товара в корзине.

Темплейт: карточка маленького формата (макет: basket item).

Отвечает за:
- отображение миниатюры товара;
- отображение названия и цены;
- кнопку удаления товара из корзины.

Генерирует события:
- `basket:item-remove` — пользователь нажал на кнопку удаления.

### 3.4. Формы (2 вида + общий родитель)
Обе формы наследуются от `BaseForm` и используют разные темплейты из макета.  
Они не содержат логики — только генерируют события о вводе данных и отображают ошибки.

#### 3.4.1. OrderPaymentDeliveryForm
Форма выбора способа оплаты и ввода адреса доставки.

Темплейт: модальное окно — форма оформления заказа (шаг 1).

Элементы:
- кнопки выбора оплаты: "card" / "cash";
- поле ввода адреса доставки;
- кнопка «Далее».

Отвечает за:
- отслеживание выбранного способа оплаты (кнопки с модификатором `button_alt-active`);
- отображение ошибки, если поле адреса пустое;
- блокировку/разблокировку кнопки «Далее»;
- генерацию событий изменения данных формы.

Генерируемые события:
- `order:payment-change` — выбран другой способ оплаты;
- `order:address-input` — изменено поле адреса;
- `order:step1-submit` — нажата кнопка «Далее».

#### 3.4.2. OrderContactsForm
Форма ввода контактных данных покупателя.

Темплейт: модальное окно — форма оформления заказа (шаг 2).

Элементы:
- поле email;
- поле phone;
- кнопка «Оплатить».

Отвечает за:
- отображение ошибок при неверном email/телефоне;
- обновление состояния кнопки «Оплатить»;
- генерацию событий изменения данных формы.

Генерируемые события:
- `order:email-input`;
- `order:phone-input`;
- `order:submit` — пользователь нажал «Оплатить».

### 3.5. Модальное окно
Компонент модального окна отвечает за отображение любых компонентов внутри всплывающего окна.  
Не имеет дочерних классов и не наследуется от карточек или форм.

Темплейт: элемент `.modal` + `.modal__content` из разметки макета.

Отвечает за:
- открытие и закрытие модального окна;
- вставку внутрь любого View-компонента (`render()` компонента);
- управление состоянием модалки (добавление/удаление модификатора `modal_active`);
- блокировку прокрутки страницы при открытии модалки;
- закрытие по:
  - клику на крестик,
  - клику по фону/оверлею,
  - вызову метода `close()`.

Методы:
- `open(content: HTMLElement)` — открыть окно и вставить контент;
- `close()` — закрыть окно и очистить контент;
- `render()` — возвращает корневой DOM модалки.

Генерирует события:
- `modal:open` — модальное окно открыто;
- `modal:close` — модальное окно закрыто.

### 3.6. Дополнительные компоненты страницы (Page, Basket, Success)

#### Page
Компонент страницы, объединяющий основные элементы интерфейса.

Отвечает за:
- отображение каталога товаров;
- управление контейнером `.gallery`;
- отображение и обновление счётчика товаров в корзине;
- обработку клика по иконке корзины;
- блокировку прокрутки страницы при открытии модального окна.

Методы:
- `setItems(items: HTMLElement[])` — вставляет карточки каталога;
- `setBasketCounter(count: number)` — обновляет значение счётчика;
- `toggleScrollLock(isLocked)` — включает/выключает прокрутку.

**Генерируемые события:**
- `page:open-basket` — пользователь нажал на иконку корзины.

#### BasketView
Компонент отображения содержимого корзины (не сама карточка, а список внутри модалки).

Содержит:
- контейнер для списка товаров;
- надпись «Корзина пуста», если товаров нет;
- блок итоговой суммы;
- кнопку «Оформить».

Отвечает за:
- рендеринг списка карточек корзины;
- отображение total-стоимости;
- выключение/включение кнопки оформления заказа.

Генерируемые события:
- `basket:checkout` — клик по кнопке «Оформить».

#### Success
Компонент окна успешной оплаты.

Отвечает за:
- отображение сообщения об успешной оплате;
- кнопку закрытия окна.

Генерирует событие:
- `success:close` — пользователь закрыл окно.

### 3.7. События View-слоя
Все события генерируются компонентами Представления и обрабатываются в Презентере.  
Они описывают действия пользователя и не содержат логики обработки.

#### События карточек товаров:
- `card:select` — выбор товара в каталоге.
- `card:add-to-basket` — кнопка «Купить» в каталоге.
- `preview:add-to-basket` — кнопка «Купить» в модальном окне товара.
- `preview:remove-from-basket` — кнопка «Удалить из корзины» в модальном окне товара.
- `basket:item-remove` — удаление товара из карточки в корзине.

#### События корзины:
- `page:open-basket` — клик по иконке корзины.
- `basket:checkout` — кнопка «Оформить» в корзине.

#### События формы оформления заказа:
- `order:payment-change` — смена способа оплаты.
- `order:address-input` — изменение поля адреса.
- `order:step1-submit` — пользователь нажал «Далее».

#### События формы контактов:
- `order:email-input` — изменение поля email.
- `order:phone-input` — изменение поля телефона.
- `order:submit` — пользователь нажал «Оплатить».

#### События модального окна:
- `modal:open` — модалка открыта.
- `modal:close` — модалка закрыта.

#### События окна успешной оплаты:
- `success:close` — пользователь закрыл сообщение об оплате.